{% extends 'base.html' %}

{% block title %}Home - Vacation Rentals{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="hero-section">
    <div class="container text-center">
        <h1 class="display-3 fw-bold mb-4">Find Your Perfect Vacation Rental</h1>
        <p class="lead mb-5">Discover amazing properties in beautiful locations</p>
        
        <!-- Search Form -->
        <div class="row justify-content-center">
            <div class="col-md-8">
                <form action="{% url 'properties:property_list' %}" method="get" class="position-relative">
                    <div class="input-group input-group-lg">
                        <input 
                            type="text" 
                            class="form-control" 
                            id="location-search" 
                            name="location" 
                            placeholder="Where do you want to go? (e.g., Miami, Aspen, California)"
                            autocomplete="off"
                        >
                        <button class="btn btn-warning btn-lg" type="submit">
                            üîç Search
                        </button>
                    </div>
                    <div id="autocomplete-list" class="autocomplete-items"></div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Featured Destinations -->
<div class="container my-5">
    <h2 class="text-center mb-4">Popular Destinations</h2>
    <div class="row">
        <div class="col-md-4 mb-3">
            <div class="card">
                <img src="https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=400" class="card-img-top" alt="Beach">
                <div class="card-body text-center">
                    <h5 class="card-title">Beach Destinations</h5>
                    <a href="{% url 'properties:property_list' %}?location=Florida" class="btn btn-primary">Explore</a>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card">
                <img src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400" class="card-img-top" alt="Mountains">
                <div class="card-body text-center">
                    <h5 class="card-title">Mountain Retreats</h5>
                    <a href="{% url 'properties:property_list' %}?location=Colorado" class="btn btn-primary">Explore</a>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card">
                <img src="https://images.unsplash.com/photo-1480714378408-67cf0d13bc1b?w=400" class="card-img-top" alt="City">
                <div class="card-body text-center">
                    <h5 class="card-title">City Escapes</h5>
                    <a href="{% url 'properties:property_list' %}?location=Miami" class="btn btn-primary">Explore</a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- How It Works -->
<div class="bg-light py-5">
    <div class="container">
        <h2 class="text-center mb-5">How It Works</h2>
        <div class="row text-center">
            <div class="col-md-4">
                <div class="mb-3">
                    <span style="font-size: 3rem;">üîç</span>
                </div>
                <h4>Search</h4>
                <p>Find your perfect vacation rental by location, amenities, or price</p>
            </div>
            <div class="col-md-4">
                <div class="mb-3">
                    <span style="font-size: 3rem;">üìÖ</span>
                </div>
                <h4>Book</h4>
                <p>Reserve your chosen property with our secure booking system</p>
            </div>
            <div class="col-md-4">
                <div class="mb-3">
                    <span style="font-size: 3rem;">üèñÔ∏è</span>
                </div>
                <h4>Enjoy</h4>
                <p>Relax and enjoy your amazing vacation experience</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Autocomplete functionality
const searchInput = document.getElementById('location-search');
const autocompleteList = document.getElementById('autocomplete-list');

let debounceTimer;

searchInput.addEventListener('input', function() {
    const query = this.value.trim();
    
    // Clear previous timer
    clearTimeout(debounceTimer);
    
    // Clear autocomplete if query is empty
    if (query.length < 2) {
        autocompleteList.innerHTML = '';
        return;
    }
    
    // Debounce API calls
    debounceTimer = setTimeout(() => {
        fetchLocations(query);
    }, 300);
});

async function fetchLocations(query) {
    try {
        const response = await fetch(`/api/locations/autocomplete/?q=${encodeURIComponent(query)}`);
        const locations = await response.json();
        
        displayAutocomplete(locations);
    } catch (error) {
        console.error('Error fetching locations:', error);
    }
}

function displayAutocomplete(locations) {
    autocompleteList.innerHTML = '';
    
    if (locations.length === 0) {
        return;
    }
    
    locations.forEach(location => {
        const item = document.createElement('div');
        item.className = 'autocomplete-item';
        item.textContent = `${location.name}, ${location.state}, ${location.country}`;
        
        item.addEventListener('click', function() {
            searchInput.value = location.name;
            autocompleteList.innerHTML = '';
            // Submit the form
            searchInput.closest('form').submit();
        });
        
        autocompleteList.appendChild(item);
    });
}

// Close autocomplete when clicking outside
document.addEventListener('click', function(e) {
    if (e.target !== searchInput) {
        autocompleteList.innerHTML = '';
    }
});
</script>
{% endblock %}