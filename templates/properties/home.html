{% extends 'base.html' %}

{% block title %}Home - Vacation Rentals{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="hero-section">
    <div class="container text-center">
        <h1 class="display-3 fw-bold mb-4">Find Your Perfect Vacation Rental</h1>
        <p class="lead mb-5">Discover amazing properties in beautiful locations</p>
        
        <!-- Search Form with Glass Effect -->
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="search-wrapper">
                    <form action="{% url 'properties:property_list' %}" method="get" class="position-relative">
                        <div class="input-group input-group-lg">
                            <input 
                                type="text" 
                                class="form-control" 
                                id="location-search" 
                                name="location" 
                                placeholder="Where do you want to go? (e.g., Miami, Aspen, California)"
                                autocomplete="off"
                            >
                            <button class="btn btn-warning btn-lg" type="submit">
                                <i class="bi bi-search"></i> Search
                            </button>
                        </div>
                        <div id="autocomplete-list" class="autocomplete-items"></div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Featured Destinations -->
<div class="container my-5">
    <h2 class="text-center mb-4">Popular Destinations</h2>
    <div class="row">
        <div class="col-md-4 mb-3">
            <div class="card">
                <img src="https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=400" class="card-img-top" alt="Beach">
                <div class="card-body text-center">
                    <h5 class="card-title">Beach Destinations</h5>
                    <a href="{% url 'properties:property_list' %}?location=Florida" class="btn btn-primary">Explore</a>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card">
                <img src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400" class="card-img-top" alt="Mountains">
                <div class="card-body text-center">
                    <h5 class="card-title">Mountain Retreats</h5>
                    <a href="{% url 'properties:property_list' %}?location=Colorado" class="btn btn-primary">Explore</a>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card">
                <img src="https://images.unsplash.com/photo-1480714378408-67cf0d13bc1b?w=400" class="card-img-top" alt="City">
                <div class="card-body text-center">
                    <h5 class="card-title">City Escapes</h5>
                    <a href="{% url 'properties:property_list' %}?location=Miami" class="btn btn-primary">Explore</a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- How It Works -->
<!-- How It Works - Premium Section -->
<section class="how-it-works-section py-5">
    <div class="container">
        <div class="text-center title mb-5">
            <h2 class="fw-bold display-6">How VacationStay Works</h2>
            <p class="text-dark opacity-75">
                Booking your dream vacation rental has never been easier.
            </p>
        </div>

        <div class="row g-4">
            <!-- Step 1 -->
            <div class="col-md-4">
                <div class="how-card text-center p-4 h-100">
                    <div class="icon-wrapper mb-4">
                        <i class="bi bi-search"></i>
                    </div>
                    <h4 class="fw-semibold mb-3">Search Destinations</h4>
                    <p>
                        Browse thousands of premium vacation rentals across
                        beaches, mountains, and cities.
                    </p>
                </div>
            </div>

            <!-- Step 2 -->
            <div class="col-md-4">
                <div class="how-card text-center p-4 h-100">
                    <div class="icon-wrapper mb-4">
                        <i class="bi bi-calendar-check"></i>
                    </div>
                    <h4 class="fw-semibold mb-3">Book Securely</h4>
                    <p>
                        Reserve your property with our secure and reliable
                        booking system.
                    </p>
                </div>
            </div>

            <!-- Step 3 -->
            <div class="col-md-4">
                <div class="how-card text-center p-4 h-100">
                    <div class="icon-wrapper mb-4">
                        <i class="bi bi-emoji-smile"></i>
                    </div>
                    <h4 class="fw-semibold mb-3">Enjoy Your Stay</h4>
                    <p>
                        Relax and experience a comfortable, unforgettable
                        vacation.
                    </p>
                </div>
            </div>
        </div>

        <!-- CTA -->
        <div class="text-center mt-5">
            <a href="{% url 'properties:property_list' %}" class="btn btn-warning btn-lg px-4">
                Explore Properties
            </a>
        </div>
    </div>
</section>

{% endblock %}

{% block extra_js %}
<script>
// Autocomplete functionality
const searchInput = document.getElementById('location-search');
const autocompleteList = document.getElementById('autocomplete-list');

let debounceTimer;

searchInput.addEventListener('input', function() {
    const query = this.value.trim();
    
    // Clear previous timer
    clearTimeout(debounceTimer);
    
    // Clear autocomplete if query is empty
    if (query.length < 2) {
        autocompleteList.innerHTML = '';
        return;
    }
    
    // Debounce API calls
    debounceTimer = setTimeout(() => {
        fetchLocations(query);
    }, 300);
});

async function fetchLocations(query) {
    try {
        const response = await fetch(`/api/locations/autocomplete/?q=${encodeURIComponent(query)}`);
        const locations = await response.json();
        
        displayAutocomplete(locations);
    } catch (error) {
        console.error('Error fetching locations:', error);
    }
}

function displayAutocomplete(locations) {
    autocompleteList.innerHTML = '';
    
    if (locations.length === 0) {
        return;
    }
    
    locations.forEach(location => {
        const item = document.createElement('div');
        item.className = 'autocomplete-item';
        item.textContent = `${location.name}, ${location.state}, ${location.country}`;
        
        item.addEventListener('click', function() {
            searchInput.value = location.name;
            autocompleteList.innerHTML = '';
            // Submit the form
            searchInput.closest('form').submit();
        });
        
        autocompleteList.appendChild(item);
    });
}

// Close autocomplete when clicking outside
document.addEventListener('click', function(e) {
    if (e.target !== searchInput) {
        autocompleteList.innerHTML = '';
    }
});
</script>
{% endblock %}